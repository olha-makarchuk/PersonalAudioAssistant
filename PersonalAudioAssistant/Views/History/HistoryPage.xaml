<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="PersonalAudioAssistant.Views.History.HistoryPage"
    BackgroundColor="White">
    
    <ScrollView>
        <Grid Padding="15" RowDefinitions="Auto, *, Auto">
        <!-- CollectionView for Conversations -->
        <CollectionView
            ItemsSource="{Binding Conversations}"
            SelectionMode="Single"
            SelectedItem="{Binding SelectedConversation, Mode=TwoWay}"
            RemainingItemsThreshold="5"
            RemainingItemsThresholdReachedCommand="{Binding LoadMoreCommand}"
            Margin="0,10,0,0">

            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="10"/>
            </CollectionView.ItemsLayout>

            <!-- Item Template for Conversations -->
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="10" Margin="0,5" BackgroundColor="White" HasShadow="True" CornerRadius="10" InputTransparent="True">
                        <VerticalStackLayout Spacing="10">
                            <!-- Conversation Title -->
                            <Label
                                Text="{Binding Description}"
                                FontAttributes="Bold"
                                FontSize="16"
                                LineBreakMode="TailTruncation"
                                MaxLines="2"
                                TextColor="Black"/>

                            <!-- Conversation Date -->
                            <Label
                                Text="{Binding DateTimeCreated}"
                                FontSize="12"
                                TextColor="Gray"/>

                            <!-- Separator -->
                            <BoxView HeightRequest="1" BackgroundColor="#E0E0E0"/>
                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

            <!-- Footer with Activity Indicator -->
            <CollectionView.Footer>
                <Grid Padding="10" HorizontalOptions="Center">
                    <ActivityIndicator
                        IsVisible="{Binding IsLoadingMore}"
                        IsRunning="{Binding IsLoadingMore}"
                        WidthRequest="30"
                        HeightRequest="30"
                        Color="Black" />
                </Grid>
            </CollectionView.Footer>

        </CollectionView>

        <!-- Main Loading Activity Indicator -->
        <ActivityIndicator
            IsVisible="{Binding IsBusy}"
            IsRunning="{Binding IsBusy}"
            VerticalOptions="Center"
            HorizontalOptions="Center"
            WidthRequest="50"
            HeightRequest="50"
            Color="Black"
            Grid.Row="2"/>
    </Grid>
    </ScrollView>
</ContentPage>
